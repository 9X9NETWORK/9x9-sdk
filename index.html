<!DOCTYPE HTML>
<html lang="zh-tw">
<head>
	<title>9x9 SDK 使用方法說明</title>
	<meta charset="UTF-8">
	<link href="css/prettify.css" type="text/css" rel="stylesheet"/>
	<link href="css/style.css" type="text/css" rel="stylesheet"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.js"></script>
	<script src="js/prettify.js"></script>
	<script src="js/nn-sdk.js"></script>
	<script src="js/main.js"></script>
</head>
<body>
	<h1 class="align-center">9x9 SDK 使用方法說明</h1>
	<div class="align-center">
		<p><b>9x9 SDK</b> 為各個不同的前端專案共通的部分，提供一個統合的界面，力求減低被分別開發的各別前端應用間的差異。</p>
		<div class="align-right"><a href="mailto:louis.jeng@9x9.tv"><img src="http://goo.gl/2gC5w" alt="Louis Jeng"/></a><br /><i>2012.08.21</i></div>
	</div>
	<hr />
	<p><a href="js/nn-sdk.js">9x9 SDK</a> 是用 Javascript 寫成，只要在網頁適當地方引入即可。<del>目前最新版本為 0.0.1。</del></p>
	<h2>相依元件</h2>
	<ul>
		<li>jQuery-1.8.x</li>
	</ul>
	<h2>初始化</h2>
	<p>凡必先初始化始得以呼叫 9x9 SDK 之其它功能也</p>
	<pre class="prettyprint">
	
	$(function() {
		nn.initialize();
	});
	</pre>
	<h2>LOG</h2>
	<pre class="prettyprint">
	
	nn.log('I am info');
	nn.log('I am info', 'info');
	nn.log('I am warning', 'warning');
	nn.log('I am error', 'error');
	nn.log('I am debug', 'debug');
	</pre>
	<h2>i18n</h2>
	<button id="i18n-btn-1">World</button>
	<button id="i18n-btn-2">Helo {0}, there are {1} people online</button>
	<button id="i18n-btn-3">Bye bye!</button>
	<pre class="prettyprint">
	
	var langPack = { // this pack can be loaded from api
		
		'Helo {0}, there are {1} people online': '您好 {0}, 現在有 {1} 個人在線上',
		'World': '世界'
	};
	
	nn.i18n(langPack); // initialize i18n
	
	$('#i18n-btn-1').click(function() {
		
		alert(nn._('World'));
	});
	$('#i18n-btn-2').click(function() {
		
		alert(nn._('Helo {0}, there are {1} people online', ['louis', 2]));
	});
	$('#i18n-btn-3').click(function() {
		
		alert(nn._('Bye bye!'));
	});
	</pre>
	<h2>API</h2>
	<label>拿登入 API 來作例子。( louis@tt.com / 111111 )</label><br />
	<label>輸入正確的帳密登入成功，輸入錯誤的帳密登入失敗。</label><br />
	<label>帳號：</label><input type="email" id="api-login-email"/>&nbsp;
	<label>密碼：</label><input type="password" id="api-login-password"/>
	<button id="api-login-submit">登入</button>
	<pre class="prettyprint">
	
	$('#api-login-submit').click(function() {
		
		var email = $('#api-login-email').val();
		var password = $('#api-login-password').val();
		var parameter = { 'email': email, 'password': password };
		
		nn.api('POST', 'api-login.php', parameter, function(user) {
			if (!user)
				alert('登入失敗');
			else
				alert('登入成功');
		});
	});
	</pre>
	<h3>API 呼叫的參數組合</h3>
	<pre class="prettyprint">
	
	nn.api(method, resourceURI [, parameter] [, callback] [, dataType]); // dataType 請參考 jQuery.ajax() dataType
	</pre>
	<h3>API 的錯誤處理</h3>
	<p>
		要處理 API 的錯誤情形，先必需透過 <i>nn.on()</i> 來掛載所要被執行的 callback 函式。<br />
		目前支援的掛載的錯誤碼有 200, 201, 400, 401, 403, 404, 500。<br />
		如果同時掛載同樣錯誤碼兩次以上，後者會覆寫掉前者。<br />
		callback 函式以 <i>null</i> 代替可以取消掛載。
	</p>
	<button id="api-fail-call">按我測試</button>&nbsp;<label>以錯誤的方式呼叫API－不帶任何參數</label>
	<pre class="prettyprint">
	
	nn.on(400, function(jqXHR, textStatus) {
		
		alert(textStatus + ": " + jqXHR.responseText);
	});
	
	$('#api-fail-call').click(function() {
		
		nn.api('POST', 'api-login.php', null /* 少了應有的參數 */, function(user) {
			
			// 這裡不會被執行
		});
	});
	</pre>
    <p>
        或者一次掛載多個錯誤處理。
    </p>
    <pre class="prettyprint">
    
	nn.on([ 400, 401, 403, 404 ], function(jqXHR, textStatus) {
		
		alert(textStatus + ": " + jqXHR.responseText);
	});
    </pre>
	<p>
		<small><b>註：由於 jQuery 在 ajax 錯誤處理的部分並不會對回傳的信息作 JSON 的解析。<br />
		所以，API server 在 4XX 或 5XX 的情形下會選擇以 plain text 的方式回應，而不是 JSON 的格式。</b></small>
	</p>
    <h3>進階 API 的使用：呼叫 YouTube API</h3>
    <p>你可以用 nn.api() 來呼叫 YouTube API。</p>
    <button id="api-youtube">呼叫 YouTube API</button>
    <pre class="prettyprint">
    
    $('#api-youtube').click(function() {
        
        var param = {
            'v':   2,
            'alt': 'json'
        };
        
        nn.api('GET', 'http://gdata.youtube.com/feeds/api/users/shining0810', param, function(data) {
            
            var entry = data.entry;
            
            nn.log(entry); // 請觀察 log
            
            alert(entry.title.$t);
        });
        
    });
    </pre>
    <h3>進階 API 的使用：pipe()</h3>
    <p>與 jQuery pipe() 相同用法，後進入 pipe() 者會等先進入者執行結束才開始，並接收前者所回傳的值。<br />
    程式碼範例是由 YouTube 的 user ID 取得該 user 的播放清單列表。再從列表中取得第一個播放清單。<br />
    再從播放清單中取得第一個影片的資訊。全部用 pipe() 串在一起。</p>
    <button id="api-pipe">pipe() 範例</button>
    <pre class="prettyprint">
    
    $('#api-pipe').click(function() {
        
        var param = { 'v': 2, 'alt': 'json' };
        var promise = nn.api('GET', 'http://gdata.youtube.com/feeds/api/users/shining0810', param);

        promise.pipe(function(data) {
            
            var entry = data.entry;
            var playlistUrl = entry.gd$feedLink[4].href;
            
            return nn.api('GET', playlistUrl, param);
            
        }).pipe(function(data) {
            
            var entry = data.feed.entry[0];
            nn.log(entry);
            
            return nn.api('GET', entry.content.src, param);
            
        }).pipe(function(data) {
            
            var entry = data.feed.entry[0];
            nn.log(entry);
            
            return entry.media$group.media$title.$t;
            
        }).done(function(title) {
            
            alert(title);
            
        });

    });
    </pre>
    <h3>進階 API 的使用：nn.when()</h3>
    <p><span style="color:grey">v0.0.3</span><br />
    nn.when() 是 $.when() 的改良版。原本 $.when() 只支援固定個數的 promise 傳入。
    nn.when() 在實現上更加彈性，將 promise 以陣列的方式傳入，可以支援不固定個數的 promise。
    nn.when() 會回傳一個新的 promise。新的 promise 在所傳入的所有 promise 皆被兌現後，
    才會被兌現(<i> done() </i>)。如果傳入的 promise 中任一個無法被兌現，回傳的 promise 會觸發失敗(<i> fail() </i>)。
    範例是以 Youtube API 呼叫為例，當所有的 API 都呼叫成功 done() 才會被觸發，否則 fail() 就會被觸發。
    更詳細的用法請參考<a href="http://api.jquery.com/jQuery.when/">$.when()</a>。
    </p>
    <button id="api-when">nn.when() 範例</button>
    <pre class="prettyprint">
    
    $('#api-when').click(function() {
        
        var videoIds = [
            'UGLZC5em9Xo', 'EGYOEqBRThc', 'JwqM0XAJxnY', 'zmolcop0i-I',
            'rcbZ7XIc_K0', 'azP5vXYGYgg', 'mwQTHxWugWE', 'VN_kWGjgZDE',
            'JCOfxErrG8w', 'AHlyK5W7rIw', 'tXcCL2P2BmM'
        ];
        
        var apiBaseUrl = 'http://gdata.youtube.com/feeds/api/videos/';
        
        var promises = [ ];
        
        $.each(videoIds, function(i, videoId) {
            var promise = nn.api('GET', apiBaseUrl + videoId, 'v=2&amp;alt=json', 'json');
            promises.push(promise);
        });
        
        var whenPromise = nn.when(promises);
        
        whenPromise.done(function() {
            alert('done!');
        }).fail(function() {
            alert('fail!');
        });
    });
    </pre>
	<h2>附錄</h2>
	<h3>api-login.php</h3>
	<pre class="prettyprint">

&lt;?php
	
	if (!isset($_REQUEST["email"]) || !isset($_REQUEST["password"])) {
		
		header("HTTP/1.1 400 Missing Parameter");
		header("Content-Type: application/json");
		
		echo "missing email or password";
		
		exit;
	}
	
	header("HTTP/1.1 200 OK");
	header("Content-Type: application/json");
	
	if ($_REQUEST["email"] == "louis@tt.com" &amp;&amp;
		$_REQUEST["password"] == "111111") {
		
		$response = array (
			"name"   =&gt; "Louis",
			"email"  =&gt; "louis@tt.com",
			"type"   =&gt; 1,
			"gender" =&gt; 1
		);
		
		echo json_encode($response);
		
	} else {
		
		echo json_encode(null);
		
	}
	</pre>
	<br />
</body>
</html>
